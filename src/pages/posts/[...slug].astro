---
import Container from "@/components/Container.astro";
import LinkedBadge from "@/components/LinkedBadge.astro";
import RootLayout from "@/layouts/RootLayout.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const blogCollection = await getCollection(
    "blog",
    (post) => post.data.draft !== true,
  );
  const posts = blogCollection.sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
  );
  return posts.map((post) => ({
    params: { slug: post.data.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<RootLayout>
  <Container>
    <section class="mb-8">
      <p class="text-sm text-gray-600 mb-2">
        {
          new Date(post.data.date).toLocaleDateString(undefined, {
            year: "numeric",
            month: "long",
            day: "numeric",
          })
        }
      </p>
      <h1 class="font-semibold text-3xl">{post.data.title}</h1>
      {post.data.tags?.length ? (
        <p class="mt-3 text-sm text-gray-600">
          <span class="mr-2">Tags:</span>
          <span class="inline-flex flex-wrap gap-2 align-middle">
            {post.data.tags.map((tag) => (
              <LinkedBadge href={`/tags/${tag}`} key={tag} class="text-xs text-foreground bg-gray-200">
                {tag}
              </LinkedBadge>
            ))}
          </span>
        </p>
      ) : null}
    </section>
    <article
      class="prose max-w-none dark:prose-invert
             prose-h1:font-semibold prose-h1:text-2xl
             prose-h2:text-2xl prose-h2:font-semibold
             prose-h3:text-xl prose-h3:font-semibold
             prose-p:text-gray-800"
    >
      <article>
        <Content />
      </article>
    </article>
  </Container>
</RootLayout>
